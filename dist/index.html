<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

  <script src="xfire.umd.js"></script>

  <script>
    var config = {
      prefix: 'https://api.wellcloud.cc',
      list: [{
        name: 'login',
        desp: 'sercurity login',
        path: '/agent/login',
        method: 'post',
        contentType: 'formData',
        bodyStruct: {
          username: 'string',
          password: 'string',
          namespace: 'string'
        },
        defaultBody: {
          password: 'Aa123456'
        },
        status: {
          401: 'username or password wrong'
        }
      },
      {
        name: 'heartBeat',
        desp: 'agent heart beat',
        path: '/sdk/api/csta/agent/heartbeat/{{agentId}}',
        method: 'post'
      },
      {
        name: 'setAgentState',
        desp: 'set agent state',
        path: '/sdk/api/csta/agent/state',
        method: 'post',
        bodyStruct: {
          agentId: 'string?',
          loginId: 'string',
          func: 'string',
          agentMode: 'string?',
          device: 'string?',
          password: 'string'
        }
      }
      ]
    }

    const API = xfire.init(config)

    console.log(API)

    API.login.fire({}, {
      username: '5001',
      password: 'Aa123456',
      namespace: 'zhen04.cc'
    })
      .then(function (res) {
        API.$setHeaders({
          sessionId: res.sessionId
        })

        return API.heartBeat.fire({
          agentId: '5001@zhen04.cc'
        })
      })
      .then(function () {
        return API.setAgentState.fire({}, {
          'loginId': '5001@zhen04.cc',
          'device': '8001@zhen04.cc',
          'password': 'Aa123456',
          'agentMode': 'NotReady',
          'func': 'Login'
        })
      })
      .catch(function (err) {
        console.error(err)
      })
  </script>
</body>

</html>